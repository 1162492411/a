---
title: "数据库优化手段"
date: 2021-02-25T20:04:09+08:00
draft: true
categories:
  - 数据库
  - 优化
tags:
  - MySQL
  - Oracle
  - 优化
---

# 索引优化
## 索引创建的情形

* 经常出现在where或者order by中的字段
* 多表连接查询的关联字段或者外键涉及的字段
* group by的字段

## 索引的优化原则

* 对区分度比较大的字段创建索引，即不怎么重复的，如果是重复性比较高的字段，例如性别，只有男和女，给这样的字段加索引，效果不大
* 最左前缀
* 索引列上不要做任何操作(计算、函数、类型转换)，会导致索引失效
* 尽量使用覆盖索引：即要查询的列是索引列，这样可以不用回表
* 可以使用索引来避免排序，可以将排序字段也加入到索引中，group by同理
* like以通配符开头也会使得索引失效，所以最好通配符放在右边
* or连接的字段，只要有一个没有索引，那么就不会走索引

# 配置优化

* innodb_buffer_pool_size : 缓冲池大小,在专门用作MySQL数据库的服务器上，可以设置物理内存的50%~70%，典型值5-6GB(8GB内存)、20-25GB(32GB内存)、100-120GB(128GB内存)
* innodb_log_file_size : redo日志大小,可以调整为约1h左右产生的大小
* max_connections : 最大连接数
* innodb_file_per_table : 将表数据和索引放在共享表空间或者单独文件,off放在共享表空间,on放在单独的idb文件以便可以回收磁盘空间
* innodb_flush_log_at_trx_commit : 提交事务时是否立即刷新日志到硬盘，默认1实时写实时刷，0延迟写，2实时写延迟刷
* innodb_flush_method : 数据和日志写入硬盘的方式,默认fdatasync调用fsync()去刷数据文件与redo log的buffer，O_DSYNC使用O_SYNC方式打开和刷写redo log,使用fsync()刷写数据文件，O_DIRECT使用O_DIRECT打开数据文件，使用fsync()刷写数据文件跟redo log
* innodb_log_buffer_size : 设置缓存还未提交的事务的缓冲区的大小。一般默认值16MB是够用的，但如果事务之中含有blog/text等大字段，这个缓冲区会被很快填满会引起额外的IO负载。可通过查看innodb_log_waits状态，如果不为0的话，则需要增加innodb_log_buffer_size
* query_cache_size : 查询缓存的大小
